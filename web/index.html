<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple yt-dlp GUI v1.1.0</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header>
            <h1>Simple yt-dlp GUI <span class="badge">v1.1.0</span></h1>
            <button onclick="toggleSettings()" class="icon-btn">⚙️ 設定</button>
        </header>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
            <h3>系統環境設定</h3>
            <div class="setting-row">
                <label>FFmpeg 執行檔路徑</label>
                <div class="input-with-btn">
                    <input type="text" id="cfg_ffmpeg" readonly>
                    <button onclick="browseFFmpeg()">瀏覽</button>
                </div>
            </div>
            <div class="setting-row">
                <label>下載儲存目錄</label>
                <div class="input-with-btn">
                    <input type="text" id="cfg_output" readonly>
                    <button onclick="browseDir()">瀏覽</button>
                </div>
            </div>
            <button class="save-btn" onclick="saveSettings()">儲存設定</button>
        </div>

        <main>
            <!-- URL Input -->
            <div class="input-section">
                <input type="text" id="urlInput" placeholder="支援 Bilibili / YouTube / Twitch / Twitter 等數千個網站..." oninput="analyzeLink()">
                <div id="platformBadge" class="platform-badge hidden">偵測中...</div>
            </div>

            <div id="liveWarning" class="warning-box hidden">
                ⚠️ 警告：偵測到直播連結。使用「邊直播邊下載」功能未經完整測試，建議結束後再下載 VOD。
            </div>

            <!-- Enhanced Options Grid -->
            <div class="options-grid">
                <!-- 1. Video Card -->
                <label class="option-card">
                    <input type="radio" name="downloadMode" value="video" checked onchange="toggleSubOptions()">
                    <div class="card-content">
                        <span class="icon">🎬</span>
                        <span class="title">影片下載</span>
						<!-- >>> 新增的彈性空間 <<< -->
						<div class="card-spacer"></div>
                        <div class="sub-options" id="sub_video">
                            <label>畫質上限</label>
                            <select id="vid_quality">
                                <option value="best">最佳 (原始)</option>
                                <option value="4k">限制 4K</option>
                                <option value="1080">限制 1080p</option>
                                <option value="720">限制 720p</option>
                            </select>

                            <label>容器格式 (自動轉檔)</label>
                            <select id="vid_ext">
                                <option value="mp4">MP4 (通用)</option>
                                <option value="mkv">MKV (高相容)</option>
                                <option value="webm">WebM</option>
                                <option value="avi">AVI</option>
                                <option value="mov">MOV</option>
                            </select>

                            <div class="checkbox-group">
                                <label><input type="checkbox" id="vid_embed_cover" checked> 嵌入封面</label>
                                <label><input type="checkbox" id="vid_embed_meta" checked> 嵌入 Metadata</label>
                            </div>
                        </div>
                    </div>
                </label>

                <!-- 2. Audio Card -->
                <label class="option-card">
                    <input type="radio" name="downloadMode" value="audio" onchange="toggleSubOptions()">
                    <div class="card-content">
                        <span class="icon">🎵</span>
                        <span class="title">純音訊</span>
						<!-- >>> 新增的彈性空間 <<< -->
						<div class="card-spacer"></div>
                        <div class="sub-options hidden" id="sub_audio">
                            <label>輸出格式</label>
                            <select id="aud_ext">
                                <option value="mp3">MP3</option>
                                <option value="m4a">M4A (AAC)</option>
                                <option value="flac">FLAC (無損)</option>
                                <option value="wav">WAV (無損)</option>
                                <option value="opus">OPUS</option>
                            </select>

                            <label>位元率 (MP3/M4A)</label>
                            <select id="aud_bitrate">
                                <option value="320">320 kbps</option>
                                <option value="192" selected>192 kbps</option>
                                <option value="128">128 kbps</option>
                            </select>

                            <div class="checkbox-group">
                                <label><input type="checkbox" id="aud_embed_cover" checked> 嵌入封面</label>
                                <label><input type="checkbox" id="aud_embed_meta" checked> 嵌入 Metadata</label>
                            </div>
                        </div>
                    </div>
                </label>

                <!-- 3. Cover Card -->
                <label class="option-card">
                    <input type="radio" name="downloadMode" value="cover" onchange="toggleSubOptions()">
                    <div class="card-content">
                        <span class="icon">🖼️</span>
                        <span class="title">純封面</span>
						<!-- >>> 新增的彈性空間 <<< -->
						<div class="card-spacer"></div>
                        <div class="sub-options hidden" id="sub_cover">
                            <label>圖片格式</label>
                            <select id="img_ext">
                                <option value="jpg">JPG</option>
                                <option value="png">PNG</option>
                                <option value="webp">WebP</option>
                            </select>
                        </div>
                    </div>
                </label>

                <!-- 4. Metadata Card -->
                <label class="option-card">
                    <input type="radio" name="downloadMode" value="metadata" onchange="toggleSubOptions()">
                    <div class="card-content">
                        <span class="icon">📄</span>
                        <span class="title">Metadata</span>
						<!-- >>> 新增的彈性空間 <<< -->
						<div class="card-spacer"></div>
                        <div class="desc">下載 .info.json</div>
                    </div>
                </label>
            </div>

            <button class="action-btn" onclick="startDownload()">🚀 開始任務</button>

            <!-- Status -->
            <div class="status-panel">
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <div class="status-text">
                    <span id="statusMsg">就緒</span>
                    <span id="percentNum">0%</span>
                </div>
                <div id="logConsole" class="log-console"></div>
            </div>
        </main>
    </div>
    <script src="/eel.js"></script>
    <script src="script.js"></script>
</body>
</html>